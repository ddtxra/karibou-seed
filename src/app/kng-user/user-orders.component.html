<div class="container-orders">
  <div class="processing" *ngIf="openOrder" >
      <h3 i18n>Votre commande en cours </h3>
      <p i18n class="help-block">
          Votre commande du <b>{{openOrder.shipping.when|date:'EEE d MMM y'}}</b> est en cours de préparation <b>({{openOrder.getProgress()}}%)</b>
          <br/>La livraison est prévue chez <b>{{openOrder.shipping.name}}</b>
      </p>
      <mdc-linear-progress 
        #progress  determinate="true" [progress]="openOrder.getProgress()/100" [buffer]="0.75" 
        style="display:block"></mdc-linear-progress>
      <p class="footer">
      </p>
  </div>


  <!-- LAST ORDERS -->
  <p class="no-orders" [hidden]="orders.length" i18n>
    Vous n'avez pas encore de commandes &#9785;
  </p>
    
  <h3 [hidden]="!orders.length" i18n>Mes dernières commandes et feedbacks</h3>
  <p [hidden]="!orders.length" i18n class="help-block">
      Il est possible qu'une erreur se soit produite?, ou vous avez constaté un problème avec un article ?
      Sélectionner la commande si dessous, et informez l'artisan. 
  </p>

  <mdc-list border="true" [lines]="2" [hidden]="!orders.length">
    <mdc-list-item *ngFor="let order of getLimitedOrders()"                   
                    [selected]="selected?.oid==order.oid"
                    [class.autoHeight]="selected?.oid==order.oid"
                    (click)="selectedOrder(order)">
      <mdc-list-item-graphic class="hide-md">
          <mdc-icon [class.primary]="isPaidOrRefund(order)">{{getOrderStatusIcon(order)}}</mdc-icon>                 
      </mdc-list-item-graphic>
      <mdc-list-item-text >             
          <span>{{order.oid}}</span> statut {{order.payment.status}} <span>{{order.payment.issuer}}</span>           
          <mdc-list-item-secondary>
              Livraison {{order.getShippingPrice()|currency:'CHF'}} <!-- - Réduction {{order.getTotalDiscount()|currency:'CHF'}}--><br/>Annulation {{order.getFulfilledFailure()}} - Problème {{order.getFulfilledIssue().length}}
              <a href="javascript:;" class="text-secondary smaller "  
                  [hidden]="!isPending(order)"
                  (click)="cancel(order)" i18n>
                  <i class="material-icons " style="transform: translateY(5px);font-size:16px;">cancel</i>
                annuler</a>
              <a href="javascript:;" class="text-secondary smaller "   
                 [hidden]="!isPaidOrRefund(order)" (click)="feeback(order)" i18n>
                  <i class="material-icons " style="transform: translateY(5px);font-size:16px;">sms</i>
                Une erreur?
              </a>                
              
          </mdc-list-item-secondary>
          <mdc-list-item-secondary *ngIf="selected?.oid==order.oid">
            <ul>
              <li *ngFor="let item of order.items" [class.strike]="item.fulfillment.status=='failure'">
                {{item.quantity}}x {{item.title}} ({{item.part}}) 
                <span class="issue red" [hidden]="!item.fulfillment.refunded">remboursé</span>
              </li>
            </ul>
            <div class="info" [hidden]="!isPaidOrRefund(order)" i18n>       
                Il est possible qu'une erreur se soit produite? N'hésitez pas à 
                nous transmettre <a href="javascript:;" class="text-secondary" (click)="feeback(order)"> <i class="material-icons " style="transform: translateY(5px);font-size:16px;">sms</i></a> l'information!
            </div>
        </mdc-list-item-secondary>                           
      </mdc-list-item-text>  
      <mdc-list-item-meta class="text-right hide-md">
        <div style="flex:2 0 100%">{{order.shipping.when|date:'EEE d MMM y'}}</div>
        <div class="align-right bold">{{order.getTotalPrice()|currency:'CHF'}}</div>
      </mdc-list-item-meta>                    
    </mdc-list-item>
    <mdc-list-divider></mdc-list-divider>
  </mdc-list>
  <div class="more-orders" [hidden]="orders.length<4">
      <mdc-icon [fontSize]="45"  (click)="getMoreOrders()">keyboard_arrow_down</mdc-icon>             
  </div>


  <!-- LAST PRODUCTS -->
  <h3 [hidden]="!getItems().length" i18n>Mes produits</h3>
  <mdc-list [lines]="2" avatar="true" border="true" interactive="false">
    <mdc-list-item *ngFor="let rank of getItems()">
      <mdc-list-item-graphic>
        <div class="avatar"
              [ngStyle]="{'background-image': 'url(' + getThumbnail(rank.item) + ')'}">

        </div>
      </mdc-list-item-graphic>
      <mdc-list-item-text>
        {{rank.item.title}}
        <mdc-list-item-secondary>            
            <a href="javascript:;" class="text-secondary  small" i18n (click)="addToCard(rank.item)">
              <i class="material-icons " style="transform: translateY(5px);font-size:16px;">shopping_cart</i>ajouter dans le panier
            </a>            
        </mdc-list-item-secondary>      
      
      </mdc-list-item-text>
      
      <mdc-list-item-meta>
        <div class="score">
            {{rank.score}}
        </div>
      </mdc-list-item-meta>
    </mdc-list-item>    
  </mdc-list>

  <!-- FEECK -->
  <mdc-dialog #dlgFeedback 
    (accept)="onFeedback()"
    (decline)="onDecline()"
    [escapeToClose]="true"
    [clickOutsideToClose]="true">
    <mdc-dialog-header>
      <mdc-dialog-header-title>
        <span i18n></span>
      </mdc-dialog-header-title>
    </mdc-dialog-header>
    <mdc-dialog-body *ngIf="feedbackOrder">
        <form  (submit)="onFeedback()">
            <!-- CHECK -->
            <div>
                <h2 style="margin-top:inherit" i18n>N'hésitez pas à nous informer du problème que vous avez rencontré</h2>
                <ul>
                  <li *ngFor="let item of feedbackOrder.items" [class.strike]="item.fulfillment.status=='failure'">
                    {{item.quantity}}x {{item.title}} ({{item.part}}) 
                    <span class="text-right">
                        -
                        <a class="text-secondary  " href="javascript:;" >manquait</a>,
                        <a class="text-secondary  " href="javascript:;" >qualité</a>,
                        <a class="text-secondary  " href="javascript:;" >transport</a>    
                    </span>
                  </li>
                </ul>
                    
                <mdc-textarea i18n-label label="Note?" class="width-100" [ngModelOptions]="{standalone: true}"
                  kng-autosize rows="4" 
                  [ngModel]="feedbackText">
                </mdc-textarea>                  

                <p class="help-block text-center" i18n>
                  C'est la meilleure manière pour nous tous d'améliorer le service 
                  <i class="material-icons">loyalty</i>
                </p>
          
              <!-- <mdc-text-field i18n-label label="Nom" type="text" [ngModel]="edit.address.name" formControlName="name">
              </mdc-text-field>                 -->
              
          </div>
  
        </form>
        
    </mdc-dialog-body>
    <mdc-dialog-footer>
      <button mdc-dialog-button [cancel]="true">Decline</button>
      <button mdc-dialog-button (click)="onFeedback()" [disabled]="">Send</button>
    </mdc-dialog-footer>
  </mdc-dialog>
    
</div>
